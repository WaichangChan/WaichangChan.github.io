{"version":3,"sources":["../static/js/0.059e71c5.chunk.js","parts/TetrisComp.js","lib/Tetris.js","lib/Tetris.Cfg.js","lib/FlashOutAnimate.js","webpack:///./src/parts/TetrisComp.css?99f5","parts/TetrisComp.css"],"names":["webpackJsonp","79","module","__webpack_exports__","__webpack_require__","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","defineProperty","__WEBPACK_IMPORTED_MODULE_0_react__","__WEBPACK_IMPORTED_MODULE_0_react___default","n","__WEBPACK_IMPORTED_MODULE_1__lib_Tetris__","__WEBPACK_IMPORTED_MODULE_2__TetrisComp_css__","_createClass","defineProperties","target","props","i","length","descriptor","key","protoProps","staticProps","TetrisComp","_Component","_ref","_temp","_this","_ret","this","_len","arguments","args","Array","_key","getPrototypeOf","apply","concat","canvasRef","handleRef","ref","getContext","a","createElement","className","width","height","80","draw","ctx","clearRect","stageW","bw","stageH","j","drawBlock","blocks","_drawBlock","x","y","color","fillStyle","fillRect","strokeRect","rotate","center","angle","beginX","endX","beginY","endY","undefined","tmp","result","turnLeftTest","moveLeft","rs","moveRight","x4","y4","k","fallDown","startX","preY","flagY","preStatus","top","left","right","rx","_cos90","_sin90","ry","nx","step","tb","dx","leftTb","rightTb","newRect","rect","__WEBPACK_IMPORTED_MODULE_1__Tetris_Cfg__","Math","random","block","console","log","gameOver","scan","rowsToRemove","canBeRemove","push","activeAnimate","__WEBPACK_IMPORTED_MODULE_0__FlashOutAnimate__","start","running","textAlign","font","fillText","stopGame","mainLoop","timestamp","now","Date","begin","GAME_OVER","gameStatus","loop","animationId","window","requestAnimationFrame","resetGame","forEach","row","fill","GAME_PLAYED","cancelAnimationFrame","startGame","_ctx","strokeStyle","cmd","_90","PI","cos","sin","document","onkeydown","e","keyCode","81","d","stageInfo","rects","map","83","FlashOutAnimate","Animate","__WEBPACK_IMPORTED_MODULE_0__Tetris__","flashTime","_flashTime","_rowsToRemove","index","_lastTime","flashOut","save","globalAlpha","restore","stop","rowdown","rowId","preBlock","queue","animation","objId","objectId","keys","update","84","exports","content","options","hmr","transform","locals","85","version","sources","names","mappings","file","sourcesContent","sourceRoot"],"mappings":"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","file":"static/js/0.059e71c5.chunk.js","sourcesContent":["webpackJsonp([0],{\n\n/***/ 79:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_react__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_react___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_react__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__lib_Tetris__ = __webpack_require__(80);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__TetrisComp_css__ = __webpack_require__(84);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__TetrisComp_css___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2__TetrisComp_css__);\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");}return call&&(typeof call===\"object\"||typeof call===\"function\")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!==\"function\"&&superClass!==null){throw new TypeError(\"Super expression must either be null or a function, not \"+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var TetrisComp=function(_Component){_inherits(TetrisComp,_Component);function TetrisComp(){var _ref;var _temp,_this,_ret;_classCallCheck(this,TetrisComp);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=TetrisComp.__proto__||Object.getPrototypeOf(TetrisComp)).call.apply(_ref,[this].concat(args))),_this),_this.canvasRef=null,_this.handleRef=function(ref){if(ref){_this.canvasRef=ref;Object(__WEBPACK_IMPORTED_MODULE_1__lib_Tetris__[\"b\" /* startGame */])(_this.canvasRef.getContext('2d'));}else{Object(__WEBPACK_IMPORTED_MODULE_1__lib_Tetris__[\"c\" /* stopGame */])();}},_temp),_possibleConstructorReturn(_this,_ret);}_createClass(TetrisComp,[{key:'render',value:function render(){return __WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('section',{className:'topic-body'},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('h4',{className:'topic-title'},'\\u4FC4\\u7F57\\u65AF\\u65B9\\u5757'),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('canvas',{className:'tetris',width:200,height:320,ref:this.handleRef}));}}]);return TetrisComp;}(__WEBPACK_IMPORTED_MODULE_0_react__[\"Component\"]);/* harmony default export */ __webpack_exports__[\"default\"] = (TetrisComp);\n\n/***/ }),\n\n/***/ 80:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = drawBlock;\n/* harmony export (immutable) */ __webpack_exports__[\"c\"] = stopGame;\n/* harmony export (immutable) */ __webpack_exports__[\"b\"] = startGame;\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__FlashOutAnimate__ = __webpack_require__(83);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Tetris_Cfg__ = __webpack_require__(81);\n// const bw = 20; //方块的长度\n// const stageW = 10;\n// const stageH = 16;\nvar bw=__WEBPACK_IMPORTED_MODULE_1__Tetris_Cfg__[\"b\" /* stageInfo */].bw,stageH=__WEBPACK_IMPORTED_MODULE_1__Tetris_Cfg__[\"b\" /* stageInfo */].stageH,stageW=__WEBPACK_IMPORTED_MODULE_1__Tetris_Cfg__[\"b\" /* stageInfo */].stageW,blocks=__WEBPACK_IMPORTED_MODULE_1__Tetris_Cfg__[\"b\" /* stageInfo */].blocks;var center={x:1,y:1};var GAME_PLAYED=1;var GAME_OVER=0;var gameStatus=GAME_PLAYED;var begin=Date.now();var ctx=null;var cmd=null;var activeAnimate=null;var animationId=0;//绘舞台\nfunction draw(){ctx.clearRect(0,0,stageW*bw,stageH*bw);for(var i=0;i<stageH;i++){// let row = '';\nfor(var j=0;j<stageW;j++){// let bb = blockList[ stageW*i+j ];\ndrawBlock(i,j);}}}function drawBlock(i,j){/* eslint default-case:0 */switch(blocks[i][j]){case 0:break;case 2://停止的方块\n// bb.className = 'idel';\n_drawBlock(ctx,j*bw,i*bw,bw,'#0f0');break;case 1://下落的方块\n_drawBlock(ctx,j*bw,i*bw,bw);break;}}//画出方块\nfunction _drawBlock(ctx,x,y,width,color){ctx.fillStyle=color||'#f00';ctx.fillRect(x,y,width,width);ctx.strokeRect(x,y,width,width);}var _90=-Math.PI/2,_cos90=Math.cos(_90),_sin90=Math.sin(_90);function rotate(center,angle){var beginX=center.x-1;var endX=beginX+3;var beginY=center.y-1;var endY=beginY+3;if(beginX<0||endX-1===stageW){return;}if(angle===undefined){angle=90;}var tmp=null;//判断是否可以旋转\nvar result=turnLeftTest(center);if(result===true){/* console.log('不可旋转!'); *///\nreturn;}else{switch(result){case'right'://如果是从四个4格的竖条变形到横条\nif(blocks[endY][center.x]===1?moveLeft(center,2):moveLeft(center)){var rs=turnLeftTest(center);if(rs instanceof Array){//如果右移后可以旋转\nbeginX=center.x-1;endX=beginX+3;beginY=center.y-1;endY=beginY+3;tmp=rs;break;}else{//不能旋转的话恢复原位\nblocks[endY][center.x]===1?moveRight(center,2):moveRight(center);}}return;case'left':if(moveRight(center)){var _rs=turnLeftTest(center);if(_rs instanceof Array){//如果右移后可以旋转\nbeginX=center.x-1;endX=beginX+3;beginY=center.y-1;endY=beginY+3;tmp=_rs;break;}else{//不能旋转的话恢复原位\nmoveLeft(center);}}return;case'top':case'bottom':return;default:tmp=result;}}// console.log(result)\n//判断是不是四格的长条\nvar x4=blocks[center.y][endX],y4=blocks[endY][center.x];// let crossArea = false;\nif(x4===1&&(angle===90||angle===270)){//这是一个横向4格的形状\nblocks[center.y][endX]=0;blocks[endY][center.x]=1;// console.log('--1--', angle );\n}else if(y4===1&&(angle===90||angle===270)){//这是一个纵向4格的形状\nblocks[center.y][endX]=1;blocks[endY][center.x]=0;}for(var y=beginY,i=0;y<endY;y++,i++){for(var x=beginX,k=0;x<endX;x++,k++){blocks[y][x]!==2&&(blocks[y][x]=tmp[i][k]);}}}var ROTATE=32,LEFT=37,RIGHT=39,DOWN=40;document.onkeydown=function(e){cmd=e.keyCode;switch(cmd){case ROTATE:rotate(center);draw();break;case LEFT:moveLeft(center);draw();break;case RIGHT:moveRight(center);draw();break;case DOWN:fallDown(center);draw();}};function fallDown(center){//对下落方向做碰撞检测\nfor(var endY=center.y+3;endY>=center.y;endY--){for(var startX=center.x-1,endX=startX+4;startX<endX;startX++){//确保数组下标不越界\nif(!blocks[endY]||(blocks[endY][startX]&&blocks[endY][startX])===2){var preY=endY-1;if(blocks[preY]){// let preStatus = blocks[preY][startX];\n//判断在这格上方的格子是不是下落的方块\nif(blocks[preY][startX]===1){return false;}}}}}//从底部开始循环\nfor(var _endY=center.y+3;_endY>=center.y;_endY--){for(var _startX=center.x-1,_endX=_startX+4;_startX<_endX;_startX++){var flagY=_endY-1;//确保数组下标不越界\nif(blocks[flagY]&&blocks[flagY][_startX]){var preStatus=blocks[flagY][_startX];if(preStatus===1){blocks[_endY][_startX]=preStatus;blocks[_endY-1][_startX]=0;}}}}center.y++;return true;}/**\n *对左旋转做碰撞检测\n *是：碰撞\n *否：没碰撞\n */function turnLeftTest(center){var top={x:center.x,y:center.y-1,value:blocks[center.y-1][center.x]};if(top.value===1&&blocks[top.y][center.x-1]===2){return'left';}var left={x:center.x-1,y:center.y,value:blocks[center.y][center.x-1]};if(left.value===1&&blocks[center.y+1][left.x]===2){return'left';}var right={x:center.x+1,y:center.y,value:blocks[center.y][center.x+1]};if(right.value===1&&blocks[center.y-1][right.x]===2){return'right';}var bottom={x:center.x,y:center.y+1,value:blocks[center.y+1][center.x]};if(bottom.value===1&&blocks[center.y][center.x+1]===2){return'right';}var endX=center.x+2,endY=center.y+2;var x4=blocks[center.y][endX],y4=blocks[endY]&&blocks[endY][center.x];if(x4===1){//这是一个横向4格的形状\nif(y4===2||y4===undefined){//如果旋转后会碰到死亡的方块，不让其旋转\nreturn true;}}else if(y4===1){//这是一个纵向4格的形状\nif(x4===2||x4===undefined){// crossArea = true;\nreturn'right';}}//如果是4格长条，判断右下角是否有死亡的方块，有就不能旋转\nif(blocks[endY][endX]===2||blocks[center.y+1][endX]===2){return'right';}var beginX=center.x-1;endX=beginX+3;var beginY=center.y-1;endY=beginY+3;var tmp=[[0,0,0],[0,0,0],[0,0,0]];for(var y=beginY,i=0;y<endY;y++,i--){for(var x=beginX,k=0;x<endX;x++,k++){var rx=_cos90*(k-1)-_sin90*(i+1)+1+0.01>>0;var ry=-1*(_cos90*(i+1)+_sin90*(k-1)-1-0.01)>>0;var nx=beginX+rx;if(blocks[beginY+ry][nx]===2){//console.log('======>不能旋转');\nif(nx<center.x){//rotate(center, angle);\nreturn'left';}else if(nx>center.x){return'right';}}blocks[y][x]!==2&&(tmp[ry][rx]=blocks[y][x]?1:0);}}return tmp;}/**\n *对右旋转做碰撞检测\n *//* eslint no-unused-vars: \"off\" */function turnRightTest(center){var top={x:center.x,y:center.y-1,value:blocks[center.y-1][center.x]};if(top.value===1&&blocks[top.y][center.x+1]===2){return true;}var left={x:center.x-1,y:center.y,value:blocks[center.y][center.x-1]};if(left.value===1&&blocks[center.y-1][left.x]===2){return true;}var right={x:center.x+1,y:center.y,value:blocks[center.y][center.x+1]};if(right.value===1&&blocks[center.y+1][right.x]===2){return true;}var bottom={x:center.x,y:center.y+1,value:blocks[center.y+1][center.x]};if(bottom.value===1&&blocks[bottom.y][center.x-1]===2){return true;}return false;}/**\n *左移\n */function moveLeft(center,step){if(center.x===0){return false;}step=step||1;var beginX=center.x-1,endX=beginX+3;var beginY=center.y-1,endY=beginY+4;for(var x=beginX;x<endX;x++){for(var y=beginY;y<endY;y++){var tb=blocks[y];//判断是否可移动\nif(tb&&tb[x]===1){//console.log('-------------->>', x);\nvar i=1;while(i<=step){if(tb[x-i]===undefined||tb[x-i]===2)return false;i++;}}}}endX+=2;endY+=1;for(var _x=beginX;_x<endX;_x++){for(var _y=beginY;_y<endY;_y++){var _tb=blocks[_y]&&blocks[_y][_x];var dx=_x-step;var leftTb=blocks[_y]&&blocks[_y][dx];if(_tb===1){blocks[_y][dx]=_tb;}else if(leftTb!==2){leftTb&&(blocks[_y][dx]=0);}}}center.x-=step;return true;}/**\n *右移\n *false 不能移动\n */function moveRight(center,step){if(center.x===stageW-1){return;}step=step||1;var endX=center.x-1,beginX=center.x+2;var beginY=center.y-1,endY=beginY+3;for(var x=beginX;x>=endX;x--){for(var y=beginY;y<endY;y++){var tb=blocks[y];//判断是否可移动\nif(tb&&tb[x]===1){var i=1;while(i<=step){if(tb[x+i]===undefined||tb[x+i]===2)return false;i++;}}}}endX--;endY+=2;for(var _x2=beginX;_x2>=endX;_x2--){for(var _y2=beginY;_y2<endY;_y2++){var _tb2=blocks[_y2]&&blocks[_y2][_x2];var dx=_x2+step;var rightTb=blocks[_y2]&&blocks[_y2][dx];if(_tb2===1){blocks[_y2][dx]=_tb2;}else if(rightTb!==2){rightTb&&(blocks[_y2][dx]=0);}}}center.x+=step;return true;}/**\n *生成新方块\n */function newRect(center){//把原来的方块从状态1变为2\nvar beginX=center.x-1;var endX=beginX+4;var beginY=center.y-1;var endY=beginY+4;for(var x=beginX;x<endX;x++){for(var y=beginY;y<endY;y++){var tb=blocks[y];//判断是否可移动\nif(tb&&tb[x]===1){tb[x]=2;}}}var rect=__WEBPACK_IMPORTED_MODULE_1__Tetris_Cfg__[\"a\" /* rects */][Math.random()*__WEBPACK_IMPORTED_MODULE_1__Tetris_Cfg__[\"a\" /* rects */].length>>0];center.x=stageW/2>>0;center.y=1;beginX=center.x-1;endX=beginX+4;beginY=center.y-1;endY=beginY+4;for(var _y3=beginY,i=0;_y3<endY;_y3++,i++){for(var _x3=beginX,k=0;_x3<endX;_x3++,k++){var block=rect[i][k];if(blocks[_y3][_x3]===0){blocks[_y3][_x3]=block;}else{/* eslint no-console:0 */console.log('GAME OVER');gameOver();return;}}}var angle=90*(Math.random()*4>>0);if(0===blocks[3][center.x]||0!==angle%180){rotate(center,angle);}}/**\n *消除行\n */function scan(){var rowsToRemove=[];for(var i=0;i<stageH;i++){var canBeRemove=true;for(var j=0;j<stageW;j++){if(blocks[i][j]!==2){canBeRemove=false;break;}}if(canBeRemove){rowsToRemove.push(i);}}if(rowsToRemove.length>0){activeAnimate=__WEBPACK_IMPORTED_MODULE_0__FlashOutAnimate__[\"a\" /* Animate */].start(new __WEBPACK_IMPORTED_MODULE_0__FlashOutAnimate__[\"b\" /* FlashOutAnimate */](ctx,3,rowsToRemove));activeAnimate.running=true;}}function gameOver(){ctx.clearRect(0,0,stageW*bw,stageH*bw);ctx.fillStyle='#333333';ctx.textAlign='center';ctx.font='bold 30px Arial';ctx.fillText('GAME OVER',stageW*bw*.5,stageH*bw*0.5);stopGame();}function mainLoop(timestamp){var now=Date.now();if(now-begin>=500&&GAME_OVER!==gameStatus&&(!activeAnimate||!activeAnimate.running)){// console.log(now - begin);\nif(!fallDown(center)){newRect(center);scan();}GAME_OVER!==gameStatus&&draw();begin=now;}__WEBPACK_IMPORTED_MODULE_0__FlashOutAnimate__[\"a\" /* Animate */].loop(timestamp);animationId=window.requestAnimationFrame(mainLoop);}function resetGame(){// blocks.fill(1).map(() => new Array(stageW).fill(0));\nblocks.forEach(function(row,i){blocks[i]=new Array(stageW).fill(0);});gameStatus=GAME_PLAYED;}function stopGame(){gameStatus=GAME_OVER;cancelAnimationFrame(animationId);}function startGame(_ctx){ctx=_ctx;ctx.strokeStyle='#00f';if(GAME_OVER==gameStatus){resetGame();}newRect(center);draw();mainLoop(0);}\n\n/***/ }),\n\n/***/ 81:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() { return stageInfo; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return rects; });\nvar bw=20;//方块的长度\nvar stageW=10;var stageH=16;var blocks=new Array(stageH).fill(1).map(function(){return new Array(stageW).fill(0);});var stageInfo={bw:bw,//方块的长度\nstageW:stageW,stageH:stageH,blocks:blocks};var rects=[[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[1,1,0,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]]];\n\n/***/ }),\n\n/***/ 83:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() { return FlashOutAnimate; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Animate; });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Tetris__ = __webpack_require__(80);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Tetris_Cfg__ = __webpack_require__(81);\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}var bw=__WEBPACK_IMPORTED_MODULE_1__Tetris_Cfg__[\"b\" /* stageInfo */].bw,stageW=__WEBPACK_IMPORTED_MODULE_1__Tetris_Cfg__[\"b\" /* stageInfo */].stageW,blocks=__WEBPACK_IMPORTED_MODULE_1__Tetris_Cfg__[\"b\" /* stageInfo */].blocks;var FlashOutAnimate=function(){function FlashOutAnimate(ctx,flashTime,rowsToRemove){_classCallCheck(this,FlashOutAnimate);this._flashTime=flashTime;this._rowsToRemove=rowsToRemove;this.index=null;this._lastTime=0;this.ctx=ctx;}_createClass(FlashOutAnimate,[{key:'update',value:function update(timestamp){if(this._lastTime===0||timestamp-this._lastTime>300){this.flashOut(this._flashTime,this._rowsToRemove);this._flashTime--;this._lastTime=timestamp;}}},{key:'flashOut',value:function flashOut(flashTime,rowsToRemove){var _this=this;var ctx=this.ctx;ctx.save();ctx.globalAlpha=flashTime%2===0?0.2:1;rowsToRemove.forEach(function(i){ctx.clearRect(0,i*bw-1,stageW*bw,bw);for(var j=0;j<stageW;j++){Object(__WEBPACK_IMPORTED_MODULE_0__Tetris__[\"a\" /* drawBlock */])(i,j);}});ctx.restore();if(flashTime<0){//结束当前动画\nAnimate.stop(this.index);rowsToRemove.forEach(function(i){_this.rowdown(i);});this.running=false;}}/**\n   *消除后调用此方法向下移\n   */},{key:'rowdown',value:function rowdown(rowId){for(var i=rowId;i>=0;i--){for(var j=0;j<stageW;j++){if(blocks[i][j]!==1){var preBlock=i-1<0?0:blocks[i-1][j];blocks[i][j]=preBlock===1?0:preBlock;}}}}}]);return FlashOutAnimate;}();var Animate={queue:{},start:function start(animation){var objId='animate_'+this.queue.length;this.queue[objId]=animation;animation.index=objId;animation.running=true;return animation;},stop:function stop(objectId){delete this.queue[objectId];},loop:function loop(timestamp){var queue=this.queue;Object.keys(queue).forEach(function(key){queue[key].update&&queue[key].update(timestamp);});}};\n\n/***/ }),\n\n/***/ 84:\n/***/ (function(module, exports, __webpack_require__) {\n\n// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = __webpack_require__(85);\nif(typeof content === 'string') content = [[module.i, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {\"hmr\":false}\noptions.transform = transform\n// add the styles to the DOM\nvar update = __webpack_require__(77)(content, options);\nif(content.locals) module.exports = content.locals;\n\n\n/***/ }),\n\n/***/ 85:\n/***/ (function(module, exports, __webpack_require__) {\n\nexports = module.exports = __webpack_require__(76)(true);\n// imports\n\n\n// module\nexports.push([module.i, \".tetris{border:1px solid #333}\", \"\", {\"version\":3,\"sources\":[\"/Users/weichengchen/work/javascript/demo-list/src/parts/TetrisComp.css\"],\"names\":[],\"mappings\":\"AAIA,QACE,qBAA0B,CAC3B\",\"file\":\"TetrisComp.css\",\"sourcesContent\":[\"/* .wrapper {\\n  text-align: center;\\n} */\\n\\n.tetris{\\n  border: 1px solid #333333;\\n}\"],\"sourceRoot\":\"\"}]);\n\n// exports\n\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/0.059e71c5.chunk.js","import React, { Component } from 'react';\n\nimport {startGame, stopGame} from '../lib/Tetris';\n\nimport './TetrisComp.css';\n\nexport default class TetrisComp extends Component {\n\n  canvasRef = null;\n\n  handleRef = (ref) => {\n    if (ref) {\n      this.canvasRef = ref;\n      startGame( this.canvasRef.getContext('2d') );\n    } else {\n      stopGame();\n    }\n  }\n\n  render() {\n    return <section className='topic-body'>\n      <h4 className='topic-title'>俄罗斯方块</h4>\n      <canvas className='tetris' width={200} height={320} ref={this.handleRef}></canvas>\n    </section>;\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/parts/TetrisComp.js","import {\n  FlashOutAnimate,\n  Animate\n} from './FlashOutAnimate';\nimport {\n  stageInfo,\n  rects\n} from './Tetris.Cfg';\n\n// const bw = 20; //方块的长度\n// const stageW = 10;\n// const stageH = 16;\n\nconst {\n  bw,\n  stageH,\n  stageW,\n  blocks\n} = stageInfo;\n\nconst center = {\n  x: 1,\n  y: 1\n};\n\nconst GAME_PLAYED = 1;\nconst GAME_OVER = 0;\n\nlet gameStatus = GAME_PLAYED;\n\nlet begin = Date.now();\n\n\nlet ctx = null;\n\nlet cmd = null;\n\nlet activeAnimate = null;\nlet animationId = 0;\n\n//绘舞台\nfunction draw() {\n\n  ctx.clearRect(0, 0, stageW * bw, stageH * bw);\n\n  for (let i = 0; i < stageH; i++) {\n    // let row = '';\n    for (let j = 0; j < stageW; j++) {\n      // let bb = blockList[ stageW*i+j ];\n      drawBlock(i, j);\n    }\n  }\n}\n\nexport function drawBlock(i, j) {\n  /* eslint default-case:0 */\n  switch (blocks[i][j]) {\n    case 0:\n      break;\n    case 2:\n      //停止的方块\n      // bb.className = 'idel';\n      _drawBlock(ctx, j * bw, i * bw, bw, '#0f0');\n      break;\n    case 1:\n      //下落的方块\n      _drawBlock(ctx, j * bw, i * bw, bw);\n      break;\n  }\n}\n\n//画出方块\nfunction _drawBlock(ctx, x, y, width, color) {\n\n  ctx.fillStyle = color || '#f00';\n\n  ctx.fillRect(x, y, width, width);\n\n  ctx.strokeRect(x, y, width, width);\n\n}\n\nlet _90 = -Math.PI / 2,\n  _cos90 = Math.cos(_90),\n  _sin90 = Math.sin(_90);\n\nfunction rotate(center, angle) {\n\n  let beginX = center.x - 1;\n  let endX = beginX + 3;\n  let beginY = center.y - 1;\n  let endY = beginY + 3;\n\n  if (beginX < 0 || endX - 1 === stageW) {\n    return;\n  }\n\n  if (angle === undefined) {\n    angle = 90;\n  }\n\n  let tmp = null;\n\n  //判断是否可以旋转\n  let result = turnLeftTest(center);\n  if (result === true) { /* console.log('不可旋转!'); */\n    //\n    return;\n\n  } else {\n\n    switch (result) {\n      case 'right':\n\n        //如果是从四个4格的竖条变形到横条\n        if (blocks[endY][center.x] === 1 ? moveLeft(center, 2) : moveLeft(center)) {\n\n          let rs = turnLeftTest(center);\n\n          if (rs instanceof Array) {\n            //如果右移后可以旋转\n            beginX = center.x - 1;\n            endX = beginX + 3;\n            beginY = center.y - 1;\n            endY = beginY + 3;\n            tmp = rs;\n            break;\n          } else {\n            //不能旋转的话恢复原位\n            blocks[endY][center.x] === 1 ? moveRight(center, 2) : moveRight(center);\n          }\n\n        }\n\n        return;\n      case 'left':\n\n        if (moveRight(center)) {\n          let rs = turnLeftTest(center);\n\n          if (rs instanceof Array) {\n            //如果右移后可以旋转\n            beginX = center.x - 1;\n            endX = beginX + 3;\n            beginY = center.y - 1;\n            endY = beginY + 3;\n            tmp = rs;\n            break;\n          } else {\n            //不能旋转的话恢复原位\n            moveLeft(center);\n          }\n        }\n        return;\n      case 'top':\n      case 'bottom':\n        return;\n      default:\n        tmp = result;\n    }\n  }\n  // console.log(result)\n\n  //判断是不是四格的长条\n  let x4 = blocks[center.y][endX],\n    y4 = blocks[endY][center.x];\n  // let crossArea = false;\n  if (x4 === 1 && (angle === 90 || angle === 270)) {\n    //这是一个横向4格的形状\n    blocks[center.y][endX] = 0;\n    blocks[endY][center.x] = 1;\n\n    // console.log('--1--', angle );\n  } else if (y4 === 1 && (angle === 90 || angle === 270)) {\n    //这是一个纵向4格的形状\n    blocks[center.y][endX] = 1;\n    blocks[endY][center.x] = 0;\n  }\n\n  for (let y = beginY, i = 0; y < endY; y++, i++) {\n    for (let x = beginX, k = 0; x < endX; x++, k++) {\n\n      blocks[y][x] !== 2 && (blocks[y][x] = tmp[i][k]);\n\n    }\n  }\n\n}\n\nlet ROTATE = 32,\n  LEFT = 37,\n  RIGHT = 39,\n  DOWN = 40;\n\ndocument.onkeydown = function (e) {\n  cmd = e.keyCode;\n\n  switch (cmd) {\n\n    case ROTATE:\n      rotate(center);\n      draw();\n      break;\n    case LEFT:\n      moveLeft(center);\n      draw();\n      break;\n    case RIGHT:\n      moveRight(center);\n      draw();\n      break;\n    case DOWN:\n      fallDown(center);\n      draw();\n\n  }\n\n};\n\n\nfunction fallDown(center) {\n\n  //对下落方向做碰撞检测\n  for (let endY = center.y + 3; endY >= center.y; endY--) {\n    for (let startX = center.x - 1, endX = startX + 4; startX < endX; startX++) {\n\n      //确保数组下标不越界\n      if (!blocks[endY] || (blocks[endY][startX] &&\n          blocks[endY][startX]) === 2) {\n        let preY = endY - 1;\n        if (blocks[preY]) {\n          // let preStatus = blocks[preY][startX];\n          //判断在这格上方的格子是不是下落的方块\n          if (blocks[preY][startX] === 1) {\n            return false;\n          }\n        }\n\n      }\n    }\n  }\n\n\n  //从底部开始循环\n  for (let endY = center.y + 3; endY >= center.y; endY--) {\n    for (let startX = center.x - 1, endX = startX + 4; startX < endX; startX++) {\n      let flagY = endY - 1;\n      //确保数组下标不越界\n      if (blocks[flagY] && blocks[flagY][startX]) {\n        let preStatus = blocks[flagY][startX];\n        if (preStatus === 1) {\n          blocks[endY][startX] = preStatus;\n          blocks[endY - 1][startX] = 0;\n        }\n      }\n    }\n  }\n  center.y++;\n  return true;\n}\n\n/**\n *对左旋转做碰撞检测\n *是：碰撞\n *否：没碰撞\n */\nfunction turnLeftTest(center) {\n  let top = {\n    x: center.x,\n    y: center.y - 1,\n    value: blocks[center.y - 1][center.x]\n  };\n  if (top.value === 1 && blocks[top.y][center.x - 1] === 2) {\n    return 'left';\n  }\n\n  let left = {\n    x: center.x - 1,\n    y: center.y,\n    value: blocks[center.y][center.x - 1]\n  };\n  if (left.value === 1 && blocks[center.y + 1][left.x] === 2) {\n    return 'left';\n  }\n\n  let right = {\n    x: center.x + 1,\n    y: center.y,\n    value: blocks[center.y][center.x + 1]\n  };\n  if (right.value === 1 && blocks[center.y - 1][right.x] === 2) {\n    return 'right';\n  }\n\n  let bottom = {\n    x: center.x,\n    y: center.y + 1,\n    value: blocks[center.y + 1][center.x]\n  };\n  if (bottom.value === 1 && blocks[center.y][center.x + 1] === 2) {\n    return 'right';\n  }\n\n  let endX = center.x + 2,\n    endY = center.y + 2;\n\n  let x4 = blocks[center.y][endX],\n    y4 = blocks[endY] && blocks[endY][center.x];\n  if (x4 === 1) {\n    //这是一个横向4格的形状\n    if (y4 === 2 || y4 === undefined) {\n      //如果旋转后会碰到死亡的方块，不让其旋转\n      return true;\n    }\n\n  } else if (y4 === 1) {\n    //这是一个纵向4格的形状\n    if (x4 === 2 || x4 === undefined) {\n      // crossArea = true;\n      return 'right';\n    }\n  }\n  //如果是4格长条，判断右下角是否有死亡的方块，有就不能旋转\n  if (blocks[endY][endX] === 2 ||\n    blocks[center.y + 1][endX] === 2) {\n    return 'right';\n  }\n\n  let beginX = center.x - 1;\n  endX = beginX + 3;\n  let beginY = center.y - 1;\n  endY = beginY + 3;\n  let tmp = [\n    [0, 0, 0],\n    [0, 0, 0],\n    [0, 0, 0]\n  ];\n\n  for (let y = beginY, i = 0; y < endY; y++, i--) {\n    for (let x = beginX, k = 0; x < endX; x++, k++) {\n\n      let rx = (_cos90 * (k - 1) - _sin90 * (i + 1) + 1 + 0.01) >> 0;\n      let ry = -1 * (_cos90 * (i + 1) + _sin90 * (k - 1) - 1 - 0.01) >> 0;\n\n      let nx = beginX + rx;\n\n      if (blocks[beginY + ry][nx] === 2) {\n        //console.log('======>不能旋转');\n\n        if (nx < center.x) {\n          //rotate(center, angle);\n          return 'left';\n        } else if (nx > center.x) {\n          return 'right';\n        }\n\n\n      }\n\n      blocks[y][x] !== 2 && (tmp[ry][rx] = blocks[y][x] ? 1 : 0);\n\n    }\n  }\n\n  return tmp;\n}\n\n/**\n *对右旋转做碰撞检测\n */\n/* eslint no-unused-vars: \"off\" */\nfunction turnRightTest(center) {\n\n  let top = {\n    x: center.x,\n    y: center.y - 1,\n    value: blocks[center.y - 1][center.x]\n  };\n  if (top.value === 1 && blocks[top.y][center.x + 1] === 2) {\n    return true;\n  }\n\n  let left = {\n    x: center.x - 1,\n    y: center.y,\n    value: blocks[center.y][center.x - 1]\n  };\n  if (left.value === 1 && blocks[center.y - 1][left.x] === 2) {\n    return true;\n  }\n\n  let right = {\n    x: center.x + 1,\n    y: center.y,\n    value: blocks[center.y][center.x + 1]\n  };\n  if (right.value === 1 && blocks[center.y + 1][right.x] === 2) {\n    return true;\n  }\n\n  let bottom = {\n    x: center.x,\n    y: center.y + 1,\n    value: blocks[center.y + 1][center.x]\n  };\n  if (bottom.value === 1 && blocks[bottom.y][center.x - 1] === 2) {\n    return true;\n  }\n  return false;\n}\n\n/**\n *左移\n */\nfunction moveLeft(center, step) {\n\n  if (center.x === 0) {\n    return false;\n  }\n\n  step = step || 1;\n\n  let beginX = center.x - 1,\n    endX = beginX + 3;\n  let beginY = center.y - 1,\n    endY = beginY + 4;\n\n  for (let x = beginX; x < endX; x++) {\n    for (let y = beginY; y < endY; y++) {\n      let tb = blocks[y];\n\n      //判断是否可移动\n      if (tb && tb[x] === 1) {\n        //console.log('-------------->>', x);\n        let i = 1;\n        while (i <= step) {\n\n          if (tb[x - i] === undefined || tb[x - i] === 2) return false;\n          i++;\n        }\n\n      }\n    }\n  }\n\n  endX += 2;\n  endY += 1;\n\n  for (let x = beginX; x < endX; x++) {\n    for (let y = beginY; y < endY; y++) {\n      let tb = blocks[y] && blocks[y][x];\n\n      let dx = x - step;\n\n      let leftTb = blocks[y] && blocks[y][dx];\n\n      if (tb === 1) {\n        (blocks[y][dx] = tb);\n      } else if (leftTb !== 2) {\n        leftTb && (blocks[y][dx] = 0);\n      }\n    }\n  }\n\n  center.x -= step;\n  return true;\n}\n\n/**\n *右移\n *false 不能移动\n */\nfunction moveRight(center, step) {\n\n  if (center.x === stageW - 1) {\n    return;\n  }\n\n  step = step || 1;\n\n  let endX = center.x - 1,\n    beginX = center.x + 2;\n  let beginY = center.y - 1,\n    endY = beginY + 3;\n\n  for (let x = beginX; x >= endX; x--) {\n    for (let y = beginY; y < endY; y++) {\n      let tb = blocks[y];\n\n      //判断是否可移动\n      if (tb && tb[x] === 1) {\n        let i = 1;\n        while (i <= step) {\n\n          if (tb[x + i] === undefined || tb[x + i] === 2) return false;\n          i++;\n        }\n      }\n    }\n  }\n\n  endX--;\n  endY += 2;\n\n  for (let x = beginX; x >= endX; x--) {\n    for (let y = beginY; y < endY; y++) {\n      let tb = blocks[y] && blocks[y][x];\n\n      let dx = x + step;\n\n      let rightTb = blocks[y] && blocks[y][dx];\n\n      if (tb === 1) {\n        (blocks[y][dx] = tb);\n      } else if (rightTb !== 2) {\n        rightTb && (blocks[y][dx] = 0);\n      }\n    }\n  }\n\n  center.x += step;\n  return true;\n}\n\n/**\n *生成新方块\n */\nfunction newRect(center) {\n\n  //把原来的方块从状态1变为2\n  let beginX = center.x - 1;\n  let endX = beginX + 4;\n  let beginY = center.y - 1;\n  let endY = beginY + 4;\n\n  for (let x = beginX; x < endX; x++) {\n    for (let y = beginY; y < endY; y++) {\n      let tb = blocks[y];\n\n      //判断是否可移动\n      if (tb && tb[x] === 1) {\n        tb[x] = 2;\n      }\n\n    }\n  }\n\n\n\n  const rect = rects[(Math.random() * rects.length) >> 0];\n  center.x = (stageW / 2) >> 0;\n  center.y = 1;\n\n  beginX = center.x - 1;\n  endX = beginX + 4;\n  beginY = center.y - 1;\n  endY = beginY + 4;\n\n  for (let y = beginY, i = 0; y < endY; y++, i++) {\n    for (let x = beginX, k = 0; x < endX; x++, k++) {\n\n      let block = rect[i][k];\n\n      if (blocks[y][x] === 0) {\n        blocks[y][x] = block;\n      } else {\n        /* eslint no-console:0 */\n        console.log('GAME OVER');\n        gameOver();\n        return;\n      }\n\n    }\n  }\n\n  let angle = 90 * (Math.random() * 4 >> 0);\n\n  if (0 === blocks[3][center.x] || (0 !== angle % 180)) {\n    rotate(center, angle);\n  }\n\n}\n\n/**\n *消除行\n */\nfunction scan() {\n\n  let rowsToRemove = [];\n\n  for (let i = 0; i < stageH; i++) {\n\n    let canBeRemove = true;\n\n    for (let j = 0; j < stageW; j++) {\n      if (blocks[i][j] !== 2) {\n        canBeRemove = false;\n        break;\n      }\n\n    }\n\n    if (canBeRemove) {\n      rowsToRemove.push(i);\n    }\n\n  }\n\n  if (rowsToRemove.length > 0) {\n\n    activeAnimate = Animate.start(new FlashOutAnimate(ctx, 3, rowsToRemove));\n    activeAnimate.running = true;\n\n  }\n\n}\n\nfunction gameOver() {\n\n  ctx.clearRect(0, 0, stageW * bw, stageH * bw);\n  ctx.fillStyle='#333333';\n  ctx.textAlign='center';\n  ctx.font='bold 30px Arial';\n  ctx.fillText('GAME OVER', stageW * bw * .5, stageH * bw * 0.5);\n  stopGame();\n}\n\nfunction mainLoop(timestamp) {\n  let now = Date.now();\n\n  if (now - begin >= 500 && GAME_OVER !== gameStatus && (!activeAnimate || !activeAnimate.running)) {\n    // console.log(now - begin);\n\n    if (!fallDown(center)) {\n      newRect(center);\n      scan();\n    }\n    GAME_OVER !== gameStatus && draw();\n    begin = now;\n  }\n\n  Animate.loop(timestamp);\n  animationId = window.requestAnimationFrame(mainLoop);\n}\n\nfunction resetGame(){\n  // blocks.fill(1).map(() => new Array(stageW).fill(0));\n  blocks.forEach((row, i) => {\n    blocks[i] = new Array(stageW).fill(0);\n  });\n  gameStatus = GAME_PLAYED;\n\n}\n\nexport function stopGame() {\n  gameStatus = GAME_OVER;\n  cancelAnimationFrame(animationId);\n}\n\nexport function startGame(_ctx) {\n  ctx = _ctx;\n  ctx.strokeStyle = '#00f';\n  \n  if( GAME_OVER == gameStatus ){\n    resetGame();\n  }\n  \n  newRect(center);\n  draw();\n  mainLoop(0);\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/Tetris.js","const bw = 20; //方块的长度\nconst stageW = 10;\nconst stageH = 16;\nconst blocks = new Array(stageH).fill(1).map(() => new Array(stageW).fill(0));\n\nexport const stageInfo = {\n  bw, //方块的长度\n  stageW,\n  stageH,\n  blocks\n};\n\nexport const rects = [\n  [\n    [0, 1, 0, 0],\n    [0, 1, 0, 0],\n    [0, 1, 0, 0],\n    [0, 1, 0, 0]\n  ],\n\n  [\n    [0, 1, 0, 0],\n    [0, 1, 0, 0],\n    [0, 1, 1, 0],\n    [0, 0, 0, 0]\n  ],\n\n  [\n    [0, 1, 0, 0],\n    [1, 1, 0, 0],\n    [0, 1, 0, 0],\n    [0, 0, 0, 0]\n  ],\n\n  [\n    [1, 1, 0, 0],\n    [0, 1, 1, 0],\n    [0, 0, 0, 0],\n    [0, 0, 0, 0]\n  ],\n\n  [\n    [1, 1, 0, 0],\n    [1, 1, 0, 0],\n    [0, 0, 0, 0],\n    [0, 0, 0, 0]\n  ]\n];\n\n\n// WEBPACK FOOTER //\n// ./src/lib/Tetris.Cfg.js","import {\n  drawBlock\n} from './Tetris';\n\nimport {stageInfo} from './Tetris.Cfg';\n\nconst {\n  bw,\n  stageW,\n  blocks\n} = stageInfo;\n\nexport class FlashOutAnimate {\n\n  constructor(ctx, flashTime, rowsToRemove) {\n    this._flashTime = flashTime;\n    this._rowsToRemove = rowsToRemove;\n    this.index = null;\n    this._lastTime = 0;\n    this.ctx = ctx;\n  }\n\n  update(timestamp) {\n\n    if (this._lastTime === 0 || (timestamp - this._lastTime > 300)) {\n      this.flashOut(this._flashTime, this._rowsToRemove);\n      this._flashTime--;\n      this._lastTime = timestamp;\n    }\n\n  }\n\n  flashOut(flashTime, rowsToRemove) {\n\n    let ctx = this.ctx;\n\n    ctx.save();\n\n    ctx.globalAlpha = (flashTime % 2 === 0 ? 0.2 : 1);\n\n    rowsToRemove.forEach(function (i) {\n\n      ctx.clearRect(0, i * bw - 1, stageW * bw, bw);\n\n      for (let j = 0; j < stageW; j++) {\n        drawBlock(i, j);\n      }\n    });\n\n    ctx.restore();\n\n    if (flashTime < 0) {\n      //结束当前动画\n      Animate.stop(this.index);\n\n      rowsToRemove.forEach((i) => {\n        this.rowdown(i);\n      });\n\n      this.running = false;\n    }\n  }\n\n  /**\n   *消除后调用此方法向下移\n   */\n  rowdown(rowId) {\n    for (let i = rowId; i >= 0; i--) {\n      for (let j = 0; j < stageW; j++) {\n\n        if (blocks[i][j] !== 1) {\n          let preBlock = i - 1 < 0 ? 0 : blocks[i - 1][j];\n\n          blocks[i][j] = (preBlock === 1 ? 0 : preBlock);\n        }\n      }\n    }\n  }\n}\n\nexport const Animate = {\n\n  queue: {},\n  start: function (animation) {\n    let objId = 'animate_' + this.queue.length;\n    this.queue[objId] = animation;\n    animation.index = objId;\n    animation.running = true;\n    return animation;\n  },\n\n  stop: function (objectId) {\n    delete this.queue[objectId];\n  },\n\n  loop: function (timestamp) {\n\n    let queue = this.queue;\n\n    Object.keys(queue).forEach(function (key) {\n      (queue[key].update) && (queue[key].update(timestamp));\n    });\n  }\n};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/FlashOutAnimate.js","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../node_modules/css-loader/index.js??ref--1-oneOf-2-2!../../node_modules/postcss-loader/lib/index.js??postcss!./TetrisComp.css\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {\"hmr\":false}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../node_modules/style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/parts/TetrisComp.css\n// module id = 84\n// module chunks = 0","exports = module.exports = require(\"../../node_modules/css-loader/lib/css-base.js\")(true);\n// imports\n\n\n// module\nexports.push([module.id, \".tetris{border:1px solid #333}\", \"\", {\"version\":3,\"sources\":[\"/Users/weichengchen/work/javascript/demo-list/src/parts/TetrisComp.css\"],\"names\":[],\"mappings\":\"AAIA,QACE,qBAA0B,CAC3B\",\"file\":\"TetrisComp.css\",\"sourcesContent\":[\"/* .wrapper {\\n  text-align: center;\\n} */\\n\\n.tetris{\\n  border: 1px solid #333333;\\n}\"],\"sourceRoot\":\"\"}]);\n\n// exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/css-loader?{\"importLoaders\":1,\"minimize\":true,\"sourceMap\":true}!./node_modules/postcss-loader/lib?{\"ident\":\"postcss\",\"plugins\":[null,null]}!./src/parts/TetrisComp.css\n// module id = 85\n// module chunks = 0"],"sourceRoot":""}